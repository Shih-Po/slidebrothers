<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <script src="js/jquery-1.12.3.min.js"></script>
    <script src="js/d3.min.js"></script>
    <script src="js/d3_test.js"></script>
    <script src="js/angular.min.js"></script>
    <link rel="stylesheet" href="css/w3.css">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>d3_test</title>
</head>
<style>
* {
    margin: 2px;
    padding: 1px;
}

header {
    text-align: left;
}

div {
    text-align: center;
    /*border: 1px solid gray;*/
    /*background-color: #E8E8E8;*/
}

#div-left {
    float: left;
    display: block;
    width: 18%;
}

#div-middle {
    float: left;
    display: block;
    width: 50%;
}

#div-right {
    float: left;
    display: block;
    width: 30%;
}

.tag {
    margin: 2px 2px;
    /*border: 1px black solid;*/
    display: inline-block;
    width: 46%;
    background-color: black;
    color: white;
    text-align: center;
    font-size: 12px;
    /* 文字行高與div高度相同時，文字垂直置中 */
    line-height: 30px;
    height: 40px;
}

.tag a {
    display: block;
    text-decoration: none;
}

.tag:hover {
    /*background-color: #FFA042;*/
    /*cursor: pointer;*/
}
</style>

<body>
    <header>
        <h1>Header</h1>
    </header>
    <!-- angularjs version  -->
    <div id="div-left" ng-app="myApp" ng-controller="genresCtrl">
        <div class="tag" value="{{x.color}}" style="background-color:{{x.color}};" ng-repeat="x in pairs">
            <a href="#">{{x.genre}}</a>
        </div>
    </div>
    <div id="div-middle">
        <!-- <h1>Map</h1> -->
    </div>
    <div id="div-right">
    </div>
</body>
<!-- angularjs -->
<script>
angular.module('myApp', []).controller('genresCtrl', function($scope) {

    $scope.pairs = [{
        "genre": "Action",
        "color": "#ffc857"
    }, {
        "genre": "Adventure",
        "color": "#e9724c"
    }, {
        "genre": "Animation",
        "color": "#c5283d"
    }, {
        "genre": "Children",
        "color": "#255f85"
    }, {
        "genre": "Comedy",
        "color": "#CEEC97"
    }, {
        "genre": "Crime",
        "color": "#576CA8"
    }, {
        "genre": "Documentary",
        "color": "#242423"
    }, {
        "genre": "Drama",
        "color": "#75f4f4"
    }, {
        "genre": "Fantasy",
        "color": "#d999b9"
    }, {
        "genre": "Film-Noir",
        "color": "#de3ca0"
    }, {
        "genre": "Horror",
        "color": "#fee2c8 "
    }, {
        "genre": "Musical",
        "color": "#12664F"
    }, {
        "genre": "Mystery",
        "color": "#774E24 "
    }, {
        "genre": "Romance",
        "color": "#9db997"
    }, {
        "genre": "Sci-Fi",
        "color": "#90e0f3"
    }, {
        "genre": "Thriller",
        "color": "#b8b3e9"
    }, {
        "genre": "War",
        "color": "#5d3d62"
    }, {
        "genre": "Western",
        "color": "#d17b88"
    }]
});
</script>
<script>
var genres = ["Action",
    "Adventure",
    "Animation",
    "Children",
    "Comedy",
    "Crime",
    "Documentary",
    "Drama",
    "Fantasy",
    "Film-Noir",
    "Horror",
    "Musical",
    "Mystery",
    "Romance",
    "Sci-Fi",
    "Thriller",
    "War",
    "Western"
]
$.post("conn.php", {
        genres: genres
    },
    function(data, status) {
        // alert("Data: " + data + "\nStatus: " + status);
        data = JSON.parse(data);
        var svg = d3.select('body div#div-middle')
            .append('div')
            .style({
                'background-color': '#E0E0E0',
            })
            .append('svg') //no effect
            .attr({
                'display': 'block',
                'width': '100%',
                'height': '500px',
                'border': '1px solid gray'
            });

        var circle = svg
            .selectAll('circle')
            .data(data)
            .enter()
            .append('circle')
            .attr({
                'cx': function(d, i) {
                    return d.count * 2;
                },
                'cy': function(d, i) {
                    return d.avg * 100;
                },
                'r': function(d, i) {
                    return 3;
                },
                'fill': function(d, i) {
                    var genres = d.genres.split('|');
                    var genre = genres[0];
                    var pairs = [{
                        "genre": "Action",
                        "color": "#ffc857"
                    }, {
                        "genre": "Adventure",
                        "color": "#e9724c"
                    }, {
                        "genre": "Animation",
                        "color": "#c5283d"
                    }, {
                        "genre": "Children",
                        "color": "#255f85"
                    }, {
                        "genre": "Comedy",
                        "color": "#CEEC97"
                    }, {
                        "genre": "Crime",
                        "color": "#576CA8"
                    }, {
                        "genre": "Documentary",
                        "color": "#242423"
                    }, {
                        "genre": "Drama",
                        "color": "#75f4f4"
                    }, {
                        "genre": "Fantasy",
                        "color": "#d999b9"
                    }, {
                        "genre": "Film-Noir",
                        "color": "#de3ca0"
                    }, {
                        "genre": "Horror",
                        "color": "#fee2c8 "
                    }, {
                        "genre": "Musical",
                        "color": "#12664F"
                    }, {
                        "genre": "Mystery",
                        "color": "#774E24 "
                    }, {
                        "genre": "Romance",
                        "color": "#9db997"
                    }, {
                        "genre": "Sci-Fi",
                        "color": "#90e0f3"
                    }, {
                        "genre": "Thriller",
                        "color": "#b8b3e9"
                    }, {
                        "genre": "War",
                        "color": "#5d3d62"
                    }, {
                        "genre": "Western",
                        "color": "#d17b88"
                    }]
                    for (var i = 0; i < pairs.length; i++) {
                        if (genre === pairs[i].genre) {
                            return pairs[i].color;
                        }
                    }
                },
                'stroke': 'grey',
                'stroke-width': '1px'
            })
            .on('mouseover', mouseOver)
            .on('mouseout', mouseOut)
            .on('click', mouseClickOnCircle);

        $('body div#div-left div.tag')
            .on('click', mouseClickOnButton);
    });
</script>

</html>
